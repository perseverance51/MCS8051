C51 COMPILER V9.60.0.0   MAIN                                                              04/23/2022 15:14:58 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          
   2          /*---------------------------------------------------------------------*/
   3          /* --- STC MCU International Limited ----------------------------------*/
   4          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
   5          /* --- Mobile: (86)13922805190 ----------------------------------------*/
   6          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
   7          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
   8          /* --- Web: www.GXWMCU.com --------------------------------------------*/
   9          /* --- QQ:  800003751 -------------------------------------------------*/
  10          /* Èç¹ûÒªÔÚ³ÌÐòÖÐÊ¹ÓÃ´Ë´úÂë,ÇëÔÚ³ÌÐòÖÐ×¢Ã÷Ê¹ÓÃÁËºê¾§¿Æ¼¼µÄ×ÊÁÏ¼°³ÌÐò   */
  11          /*---------------------------------------------------------------------*/
  12          
  13          /*************  ¹¦ÄÜËµÃ÷  **************
  14          
  15          Ë«´®¿ÚÈ«Ë«¹¤ÖÐ¶Ï·½Ê½ÊÕ·¢Í¨Ñ¶³ÌÐò¡£
  16          
  17          Í¨¹ýPCÏòMCU·¢ËÍÊý¾Ý, MCUÊÕµ½ºóÍ¨¹ý´®¿Ú°ÑÊÕµ½µÄÊý¾ÝÔ­Ñù·µ»Ø.
  18          
  19          ******************************************/
  20          
  21          
  22          #define   MAIN_Fosc     32000000L //¶¨ÒåÖ÷Ê±ÖÓ
  23          #include  "STC15Fxxxx.H"
  24          
  25          #define   Baudrate1     115200L
  26          #define   UART1_BUF_LENGTH  32
  27          
  28          
  29          u8  TX1_Cnt;  //·¢ËÍ¼ÆÊý
  30          u8  RX1_Cnt;  //½ÓÊÕ¼ÆÊý
  31          bit B_TX1_Busy; //·¢ËÍÃ¦±êÖ¾
  32          
  33          u8  idata RX1_Buffer[UART1_BUF_LENGTH]; //½ÓÊÕ»º³å
  34          
  35          
  36          void  UART1_config(u8 brt); // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
  37          void  PrintString1(u8 *puts);
  38          
  39          
  40          //========================================================================
  41          // º¯Êý: void main(void)
  42          // ÃèÊö: Ö÷º¯Êý¡£
  43          // ²ÎÊý: none.
  44          // ·µ»Ø: none.
  45          // °æ±¾: VER1.0
  46          // ÈÕÆÚ: 2014-11-28
  47          // ±¸×¢: 
  48          //========================================================================
  49          void main(void)
  50          {
  51   1        P0M1 = 0; P0M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  52   1        P1M1 = 0; P1M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  53   1        P2M1 = 0; P2M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  54   1        P3M1 = 0; P3M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  55   1        P4M1 = 0; P4M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
C51 COMPILER V9.60.0.0   MAIN                                                              04/23/2022 15:14:58 PAGE 2   

  56   1        P5M1 = 0; P5M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  57   1        P6M1 = 0; P6M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  58   1        P7M1 = 0; P7M0 = 0; //ÉèÖÃÎª×¼Ë«Ïò¿Ú
  59   1      
  60   1        UART1_config(1);  // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
  61   1        EA = 1; //ÔÊÐí×ÜÖÐ¶Ï
  62   1      
  63   1        PrintString1("STC15F2K60S2 UART1 Test Prgramme!\r\n");  //SUART1·¢ËÍÒ»¸ö×Ö·û´®
  64   1      
  65   1        while (1)
  66   1        {
  67   2          if((TX1_Cnt != RX1_Cnt) && (!B_TX1_Busy)) //ÊÕµ½Êý¾Ý, ·¢ËÍ¿ÕÏÐ
  68   2          {
  69   3            SBUF = RX1_Buffer[TX1_Cnt];   //°ÑÊÕµ½µÄÊý¾ÝÔ¶Ñù·µ»Ø
  70   3            B_TX1_Busy = 1;
  71   3            if(++TX1_Cnt >= UART1_BUF_LENGTH) TX1_Cnt = 0;
  72   3          }
  73   2        }
  74   1      }
  75          
  76          
  77          //========================================================================
  78          // º¯Êý: void PrintString1(u8 *puts)
  79          // ÃèÊö: ´®¿Ú1·¢ËÍ×Ö·û´®º¯Êý¡£
  80          // ²ÎÊý: puts:  ×Ö·û´®Ö¸Õë.
  81          // ·µ»Ø: none.
  82          // °æ±¾: VER1.0
  83          // ÈÕÆÚ: 2014-11-28
  84          // ±¸×¢: 
  85          //========================================================================
  86          void PrintString1(u8 *puts) //·¢ËÍÒ»¸ö×Ö·û´®
  87          {
  88   1          for (; *puts != 0;  puts++)     //Óöµ½Í£Ö¹·û0½áÊø
  89   1        {
  90   2          SBUF = *puts;
  91   2          B_TX1_Busy = 1;
  92   2          while(B_TX1_Busy);
  93   2        }
  94   1      }
  95          
  96          //========================================================================
  97          // º¯Êý: SetTimer2Baudraye(u16 dat)
  98          // ÃèÊö: ÉèÖÃTimer2×ö²¨ÌØÂÊ·¢ÉúÆ÷¡£
  99          // ²ÎÊý: dat: Timer2µÄÖØ×°Öµ.
 100          // ·µ»Ø: none.
 101          // °æ±¾: VER1.0
 102          // ÈÕÆÚ: 2014-11-28
 103          // ±¸×¢: 
 104          //========================================================================
 105          void  SetTimer2Baudraye(u16 dat)  // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
 106          {
 107   1        AUXR &= ~(1<<4);  //Timer stop
 108   1        AUXR &= ~(1<<3);  //Timer2 set As Timer
 109   1        AUXR |=  (1<<2);  //Timer2 set as 1T mode
 110   1        TH2 = dat / 256;
 111   1        TL2 = dat % 256;
 112   1        IE2  &= ~(1<<2);  //½ûÖ¹ÖÐ¶Ï
 113   1        AUXR |=  (1<<4);  //Timer run enable
 114   1      }
 115          
 116          //========================================================================
 117          // º¯Êý: void UART1_config(u8 brt)
C51 COMPILER V9.60.0.0   MAIN                                                              04/23/2022 15:14:58 PAGE 3   

 118          // ÃèÊö: UART1³õÊ¼»¯º¯Êý¡£
 119          // ²ÎÊý: brt: Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
 120          // ·µ»Ø: none.
 121          // °æ±¾: VER1.0
 122          // ÈÕÆÚ: 2014-11-28
 123          // ±¸×¢: 
 124          //========================================================================
 125          void  UART1_config(u8 brt)  // Ñ¡Ôñ²¨ÌØÂÊ, 2: Ê¹ÓÃTimer2×ö²¨ÌØÂÊ, ÆäËüÖµ: Ê¹ÓÃTimer1×ö²¨ÌØÂÊ.
 126          {
 127   1        /*********** ²¨ÌØÂÊÊ¹ÓÃ¶¨Ê±Æ÷2 *****************/
 128   1        if(brt == 2)
 129   1        {
 130   2          AUXR |= 0x01;   //S1 BRT Use Timer2;
 131   2          SetTimer2Baudraye(65536UL - (MAIN_Fosc / 4) / Baudrate1);
 132   2        }
 133   1      
 134   1        /*********** ²¨ÌØÂÊÊ¹ÓÃ¶¨Ê±Æ÷1 *****************/
 135   1        else
 136   1        {
 137   2          TR1 = 0;
 138   2          AUXR &= ~0x01;    //S1 BRT Use Timer1;
 139   2          AUXR |=  (1<<6);  //Timer1 set as 1T mode
 140   2          TMOD &= ~(1<<6);  //Timer1 set As Timer
 141   2          TMOD &= ~0x30;    //Timer1_16bitAutoReload;
 142   2          TH1 = (u8)((65536UL - (MAIN_Fosc / 4) / Baudrate1) / 256);
 143   2          TL1 = (u8)((65536UL - (MAIN_Fosc / 4) / Baudrate1) % 256);
 144   2          ET1 = 0;  //½ûÖ¹ÖÐ¶Ï
 145   2          INT_CLKO &= ~0x02;  //²»Êä³öÊ±ÖÓ
 146   2          TR1  = 1;
 147   2          
 148   2        }
 149   1        /*************************************************/
 150   1          //SCON = 0x50;      //8Î»Êý¾Ý£¬¿É±ä²¨ÌØÂÊ
 151   1        //SCON = (SCON & 0x3f) | 0x40;  //UART1Ä£Ê½, 0x00: Í¬²½ÒÆÎ»Êä³ö, 0x40: 8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ, 0x80: 9Î»Êý¾Ý,¹
             -Ì¶¨²¨ÌØÂÊ, 0xc0: 9Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
 152   1      //  PS  = 1;  //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
 153   1        ES  = 1;  //ÔÊÐíÖÐ¶Ï
 154   1        REN = 1;  //ÔÊÐí½ÓÊÕ
 155   1        P_SW1 &= 0x3f;
 156   1        P_SW1 |= 0x80;    //UART1 switch to, 0x00: P3.0 P3.1, 0x40: P3.6 P3.7, 0x80: P1.6 P1.7 (±ØÐëÊ¹ÓÃÄÚ²¿Ê±ÖÓ)
 157   1        PCON2 |=  (1<<4); //ÄÚ²¿¶ÌÂ·RXDÓëTXD, ×öÖÐ¼Ì, ENABLE,DISABLE
 158   1      
 159   1        B_TX1_Busy = 0;
 160   1        TX1_Cnt = 0;
 161   1        RX1_Cnt = 0;
 162   1      }
 163          
 164          
 165          //========================================================================
 166          // º¯Êý: void UART1_int (void) interrupt UART1_VECTOR
 167          // ÃèÊö: UART1ÖÐ¶Ïº¯Êý¡£
 168          // ²ÎÊý: nine.
 169          // ·µ»Ø: none.
 170          // °æ±¾: VER1.0
 171          // ÈÕÆÚ: 2014-11-28
 172          // ±¸×¢: 
 173          //========================================================================
 174          void UART1_int (void) interrupt 4
 175          {
 176   1        if(RI)
 177   1        {
 178   2          RI = 0;
C51 COMPILER V9.60.0.0   MAIN                                                              04/23/2022 15:14:58 PAGE 4   

 179   2          RX1_Buffer[RX1_Cnt] = SBUF;
 180   2          if(++RX1_Cnt >= UART1_BUF_LENGTH) RX1_Cnt = 0;  //·ÀÒç³ö
 181   2        }
 182   1      
 183   1        if(TI)
 184   1        {
 185   2          TI = 0;
 186   2          B_TX1_Busy = 0;
 187   2        }
 188   1      }
 189          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    250    ----
   CONSTANT SIZE    =     36    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =     32    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
