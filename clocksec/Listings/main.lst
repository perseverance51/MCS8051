C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2022 14:12:26 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /* Main.c file generated by New Project wizard
   2           *0-999999秒表
   3           * Created:   周四 6月 14 2022
   4           * Processor: AT89C52
   5           * Compiler:  Keil for 8051
   6           */
   7          
   8          #include <reg52.h>
   9          #define FOSC 12000000uL
  10          //#define T50MS 15536  //50ms timer calculation method in 12T mode
  11          #define T50MS (65536-FOSC*50/12/1000)   //1ms*50 timer calculation method in 12T mode
  12          
  13          sbit ADDR0 = P1^0;
  14          sbit ADDR1 = P1^1;
  15          sbit ADDR2 = P1^2;
  16          sbit ADDR3 = P1^3;
  17          sbit ENLED = P1^4;
  18          sbit led = P1^5; 
  19          unsigned char code LedChar[] = {  //数码管显示字符转换表
  20              0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,
  21              0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E
  22          };
  23          unsigned char LedBuff[6] = { //数码管显示缓冲区，初值 0xFF 确保启动时都不亮
  24              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
  25          };
  26              unsigned int cnt = 0; //记录 T0 中断次数
  27              unsigned long sec = 0; //记录经过的秒数
  28          void tm0_isr() interrupt 1
  29          {
  30   1          TL0 = T50MS;                     //reload timer0 low byte
  31   1          TH0 = T50MS >> 8;                //reload timer0 high byte
  32   1          if (cnt-- == 0)               //1ms * 1000 -> 1s
  33   1          {
  34   2              cnt = 20;               //reset counter
  35   2          sec++;  //秒计数自加 1
  36   2              led = ! led;      //work LED flash          
  37   2                      //以下代码将 sec 按十进制位从低到高依次提取并转为数码管显示字符
  38   2                      LedBuff[0] = LedChar[sec/100000];
  39   2                      LedBuff[1] = LedChar[sec%100000/10000];
  40   2                      LedBuff[2] = LedChar[sec%100000%10000/1000];
  41   2                      LedBuff[3] = LedChar[sec%100000%10000%1000/100];
  42   2                      LedBuff[4] = LedChar[sec%100000%10000%1000%100/10];
  43   2                      LedBuff[5] = LedChar[sec%100000%10000%1000%100%10];
  44   2          }
  45   1      }
  46          //延时函数
  47          void delay(int xms)
  48          {
  49   1        unsigned int i,j;
  50   1        for(i=xms;i>0;i--)
  51   1          for(j=110;j>0;j--);
  52   1      }
  53          void main(){
  54   1          unsigned char i = 0;  //动态扫描的索引      
C51 COMPILER V9.60.0.0   MAIN                                                              06/16/2022 14:12:26 PAGE 2   

  55   1          ENLED = 0;  //使能 U3，选择控制数码管
  56   1          ADDR3 = 1; //因为需要动态改变 ADDR0-2 的值，所以不需要再初始化了
  57   1         
  58   1          TMOD = 0x01;  //设置 T0 为模式 1
  59   1          TL0 = T50MS;                     //initial timer0 low byte
  60   1          TH0 = T50MS >> 8; 
  61   1        TR0 = 1;                        //timer0 start running
  62   1          ET0 = 1;                        //enable timer0 interrupt
  63   1          EA = 1;                         //open global interrupt switch
  64   1      
  65   1          while (1){
  66   2                  //以下代码完成数码管动态扫描刷新
  67   2                  switch (i){
  68   3                      case 0: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=0; i++; P0=LedBuff[0]; delay(5);ENLED=0;break;
  69   3                      case 1: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=1; i++; P0=LedBuff[1]; delay(5);ENLED=0;break;
  70   3                      case 2: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=0; i++; P0=LedBuff[2]; delay(5);ENLED=0;break;
  71   3                      case 3: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=1; i++; P0=LedBuff[3]; delay(5);ENLED=0;break;
  72   3                      case 4: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=0; i++; P0=LedBuff[4]; delay(5);ENLED=0;break;
  73   3                      case 5: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=1; i=0; P0=LedBuff[5]; delay(5);ENLED=0;break;
  74   3                      default: break;
  75   3                  } 
  76   2            P0=0xFF;//消隐
  77   2      } 
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    721    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
