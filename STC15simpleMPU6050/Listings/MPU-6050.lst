C51 COMPILER V9.60.0.0   MPU_6050                                                          02/03/2022 12:24:12 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MPU_6050
OBJECT MODULE PLACED IN .\Objects\MPU-6050.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE MPU-6050.C OPTIMIZE(8,SPEED) BROWSE INCDIR(..\STC15simpleMPU6050) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\MPU-6050.lst) TABS(2) OBJECT(.\Objects\MPU-6050.obj)

line level    source

   1          
   2          #include "config.h"
   3          #include "MPU6050.H"
   4          
   5          sbit    SCL = P2^5;   //IIC ±÷”“˝Ω≈∂®“Â
   6          sbit    SDA = P2^4;   //IIC ˝æ›“˝Ω≈∂®“Â
   7          
   8          void  InitMPU6050(void);  //≥ı ºªØMPU6050
   9          void  Delay2us(void);
  10          void  I2C_Start(void);
  11          void  I2C_Stop(void);
  12          
  13          bit   I2C_RecvACK(void);
  14          
  15          void  I2C_SendByte(u8 dat);
  16          u8    I2C_RecvByte(void);
  17          
  18          void  I2C_ReadPage(void);
  19          void  I2C_WritePage(void);
  20          u8    Single_ReadI2C(u8 REG_Address);       //∂¡»°I2C ˝æ›
  21          void  Single_WriteI2C(u8 REG_Address,u8 REG_data);  //œÚI2C–¥»Î ˝æ›
  22          
  23          
  24          //I^C ±–Ú÷–—” ±…Ë÷√£¨æﬂÃÂ≤Œº˚∏˜–æ∆¨µƒ ˝æ› ÷≤·  6050Õ∆ºˆ◊Ó–°1.3us µ´ «ª·≥ˆŒ Ã‚£¨’‚¿Ô—” ± µº 1.9us◊Û”“
  25          void Delay2us(void)
  26          {
  27   1        u8 i;
  28   1        i = 11;   // @24MHZ, 6 + 33 = 39T, 1.625us
  29   1        while (--i);
  30   1      }
  31          
  32          //**************************************
  33          //I2C∆ º–≈∫≈
  34          //**************************************
  35          void I2C_Start(void)
  36          {
  37   1        Delay2us();                 //—” ±
  38   1        Delay2us();                 //—” ±
  39   1        SDA = 1;                    //¿≠∏ﬂ ˝æ›œﬂ
  40   1        SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
  41   1        Delay2us();                 //—” ±
  42   1        Delay2us();                 //—” ±
  43   1        SDA = 0;                    //≤˙…˙œ¬Ωµ—ÿ
  44   1        Delay2us();                 //—” ±
  45   1        SCL = 0;                    //¿≠µÕ ±÷”œﬂ
  46   1        Delay2us();                 //—” ±
  47   1      }
  48          
  49          //**************************************
  50          //I2CÕ£÷π–≈∫≈
  51          //**************************************
  52          void I2C_Stop(void)
  53          {
  54   1          Delay2us();                 //—” ±
C51 COMPILER V9.60.0.0   MPU_6050                                                          02/03/2022 12:24:12 PAGE 2   

  55   1          SDA = 0;                    //¿≠µÕ ˝æ›œﬂ
  56   1          SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
  57   1        Delay2us();                 //—” ±
  58   1          SDA = 1;                    //≤˙…˙…œ…˝—ÿ
  59   1        Delay2us();                 //—” ±
  60   1      }
  61          
  62          //**************************************
  63          //I2CΩ” ’”¶¥–≈∫≈
  64          //**************************************
  65          bit I2C_RecvACK(void)
  66          {
  67   1        SDA = 1;
  68   1        Delay2us();                 //—” ±
  69   1          SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
  70   1          Delay2us();                 //—” ±
  71   1          CY = SDA;                   //∂¡”¶¥–≈∫≈
  72   1          SCL = 0;                    //¿≠µÕ ±÷”œﬂ
  73   1          Delay2us();                 //—” ±
  74   1          return CY;
  75   1      }
  76          
  77          //**************************************
  78          //œÚI2C◊‹œﬂ∑¢ÀÕ“ª∏ˆ◊÷Ω⁄ ˝æ›
  79          //**************************************
  80          void I2C_SendByte(u8 dat)
  81          {
  82   1          u8 i;
  83   1          for (i=0; i<8; i++)         //8Œªº∆ ˝∆˜
  84   1          {
  85   2              dat <<= 1;              //“∆≥ˆ ˝æ›µƒ◊Ó∏ﬂŒª
  86   2              SDA = CY;               //ÀÕ ˝æ›ø⁄
  87   2              SCL = 1;                //¿≠∏ﬂ ±÷”œﬂ
  88   2              Delay2us();             //—” ±
  89   2              SCL = 0;                //¿≠µÕ ±÷”œﬂ
  90   2              Delay2us();             //—” ±
  91   2          }
  92   1          I2C_RecvACK();
  93   1      }
  94          
  95          //**************************************
  96          //¥”I2C◊‹œﬂΩ” ’“ª∏ˆ◊÷Ω⁄ ˝æ›
  97          //**************************************
  98          u8 I2C_RecvByte(void)
  99          {
 100   1          u8 i;
 101   1          u8 dat = 0;
 102   1          SDA = 1;                    // πƒ‹ƒ⁄≤ø…œ¿≠,◊º±∏∂¡»° ˝æ›,
 103   1          for (i=0; i<8; i++)         //8Œªº∆ ˝∆˜
 104   1          {
 105   2              dat <<= 1;
 106   2              SCL = 1;                //¿≠∏ﬂ ±÷”œﬂ
 107   2              Delay2us();             //—” ±
 108   2              dat |= SDA;             //∂¡ ˝æ›
 109   2              SCL = 0;                //¿≠µÕ ±÷”œﬂ
 110   2              Delay2us();             //—” ±
 111   2          }
 112   1          return dat;
 113   1      }
 114          
 115          //**************************************
 116          //œÚI2C…Ë±∏–¥»Î“ª∏ˆ◊÷Ω⁄ ˝æ›
C51 COMPILER V9.60.0.0   MPU_6050                                                          02/03/2022 12:24:12 PAGE 3   

 117          //**************************************
 118          void Single_WriteI2C(u8 REG_Address,u8 REG_data)
 119          {
 120   1          I2C_Start();                  //∆ º–≈∫≈
 121   1          I2C_SendByte(SlaveAddress);   //∑¢ÀÕ…Ë±∏µÿ÷∑+–¥–≈∫≈
 122   1          I2C_SendByte(REG_Address);    //ƒ⁄≤øºƒ¥Ê∆˜µÿ÷∑£¨
 123   1          I2C_SendByte(REG_data);       //ƒ⁄≤øºƒ¥Ê∆˜ ˝æ›£¨
 124   1          I2C_Stop();                   //∑¢ÀÕÕ£÷π–≈∫≈
 125   1      }
 126          //**************************************
 127          //¥”I2C…Ë±∏∂¡»°“ª∏ˆ◊÷Ω⁄ ˝æ›
 128          //**************************************
 129          /*
 130          u8 Single_ReadI2C(u8 REG_Address)
 131          {
 132            u8 REG_data;
 133            I2C_Start();                   //∆ º–≈∫≈
 134            I2C_SendByte(SlaveAddress);    //∑¢ÀÕ…Ë±∏µÿ÷∑+–¥–≈∫≈
 135            I2C_SendByte(REG_Address);     //∑¢ÀÕ¥Ê¥¢µ•‘™µÿ÷∑£¨¥”0ø™ º
 136            I2C_Start();                   //∆ º–≈∫≈
 137            I2C_SendByte(SlaveAddress+1);  //∑¢ÀÕ…Ë±∏µÿ÷∑+∂¡–≈∫≈
 138            REG_data=I2C_RecvByte();       //∂¡≥ˆºƒ¥Ê∆˜ ˝æ›
 139            
 140            SDA = 1;                    //–¥”¶¥–≈∫≈
 141            SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
 142            Delay2us();                 //—” ±
 143            SCL = 0;                    //¿≠µÕ ±÷”œﬂ
 144            Delay2us();                 //—” ±
 145            
 146            I2C_Stop();                    //Õ£÷π–≈∫≈
 147            return REG_data;
 148          }
 149          */
 150          
 151          //**************************************
 152          //≥ı ºªØMPU6050
 153          //**************************************
 154          void InitMPU6050(void)
 155          {
 156   1        P2n_open_drain(0x30); //P2.4 -- SDA,   P2.5 -- SCL
 157   1        Delay2us();
 158   1        Delay2us();
 159   1        Delay2us();
 160   1        Delay2us();
 161   1      
 162   1        Single_WriteI2C(PWR_MGMT_1, 0x00);  //Ω‚≥˝–›√ﬂ◊¥Ã¨
 163   1        Single_WriteI2C(SMPLRT_DIV, 0x07);  //Õ”¬›“«125hz
 164   1        Single_WriteI2C(CONFIG, 0x04);      //21HZ¬À≤® —” ±A8.5ms G8.3ms  ¥À¥¶»°÷µ”¶œ‡µ±◊¢“‚£¨—” ±”ÎœµÕ≥÷‹∆⁄œ‡Ω¸Œ
             -™“À
 165   1        Single_WriteI2C(GYRO_CONFIG, 0x08); //Õ”¬›“«500∂»/S 65.5LSB/g
 166   1        Single_WriteI2C(ACCEL_CONFIG, 0x08);//º”ÀŸ∂»+-4g  8192LSB/g
 167   1      }
 168          
 169          void Read_MPU6050(u8 *buf)
 170          {
 171   1        u8  i;
 172   1        
 173   1        I2C_Start();                  //∆ º–≈∫≈
 174   1        I2C_SendByte(SlaveAddress);   //∑¢ÀÕ…Ë±∏µÿ÷∑+–¥–≈∫≈
 175   1        I2C_SendByte(ACCEL_XOUT_H);    //ƒ⁄≤øºƒ¥Ê∆˜µÿ÷∑£¨
 176   1        I2C_Start();                   //∆ º–≈∫≈
 177   1        I2C_SendByte(SlaveAddress+1);  //∑¢ÀÕ…Ë±∏µÿ÷∑+∂¡–≈∫≈
C51 COMPILER V9.60.0.0   MPU_6050                                                          02/03/2022 12:24:12 PAGE 4   

 178   1        for(i=0; i<13; i++)
 179   1        {
 180   2          buf[i] = I2C_RecvByte();       //∂¡≥ˆºƒ¥Ê∆˜ ˝æ›
 181   2          SDA = 0;                    //–¥”¶¥–≈∫≈
 182   2          SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
 183   2          Delay2us();                 //—” ±
 184   2          SCL = 0;                    //¿≠µÕ ±÷”œﬂ
 185   2          Delay2us();                 //—” ±
 186   2        }
 187   1          buf[i] = I2C_RecvByte();  //◊Ó∫Û“ª∏ˆ◊÷Ω⁄
 188   1          SDA = 1;                    //–¥∑«”¶¥–≈∫≈
 189   1          SCL = 1;                    //¿≠∏ﬂ ±÷”œﬂ
 190   1          Delay2us();                 //—” ±
 191   1          SCL = 0;                    //¿≠µÕ ±÷”œﬂ
 192   1          Delay2us();                 //—” ±
 193   1        I2C_Stop();                    //Õ£÷π–≈∫≈
 194   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    311    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
