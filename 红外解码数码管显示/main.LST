C51 COMPILER V9.60.0.0   MAIN                                                              05/08/2022 11:17:01 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          
   2          /**********************************************
   3          ÀûÓÃºìÍâ½ÓÊÕÍ·(VS1838)»ñÈ¡Ò£¿Ø°´¼üÂë
   4          ******************************************************************/
   5          //#include<reg52.h>    //°üº¬Í·ÎÄ¼þ£¬Ò»°ãÇé¿ö²»ÐèÒª¸Ä¶¯£¬Í·ÎÄ¼þ°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
   6          #include <STC15F2K60S2.H>
   7          
   8          #include <stdio.h>//ÓÃÓÚprintf´òÓ¡£¬ÐèÒª¼ÓÔØ´ËÍ·ÎÄ¼þ
   9          #include <stdarg.h> 
  10          
  11          sbit IR=P3^2;  //ºìÍâ½Ó¿Ú£¬ÐèÒª½Óµ½´øÍâ²¿ÖÐ¶ÏÒý½ÅÉÏ
  12          
  13          /*------------------------------------------------
  14                          È«¾Ö±äÁ¿ÉùÃ÷
  15          ------------------------------------------------*/
  16          
  17          unsigned char  irtime;//ºìÍâÓÃÈ«¾Ö±äÁ¿
  18          
  19          bit irpro_ok,irok;
  20          unsigned char IRcord[4];
  21          unsigned char irdata[33];
  22          
  23          /*------------------------------------------------
  24                            º¯ÊýÉùÃ÷
  25          ------------------------------------------------*/
  26          
  27          void Ir_work(void);
  28          void Ircordpro(void);
  29          
  30          /*------------------------------------------------
  31                           ´®¿Ú³õÊ¼»¯º¯Êý
  32          ------------------------------------------------*/
  33          void init_com(void)
  34          {
  35   1          SCON = 0x50;    //8Î»Êý¾Ý,¿É±ä²¨ÌØÂÊ
  36   1        AUXR |= 0x01;   //´®¿Ú1Ñ¡Ôñ¶¨Ê±Æ÷2Îª²¨ÌØÂÊ·¢ÉúÆ÷
  37   1        AUXR &= 0xFB;   //¶¨Ê±Æ÷Ê±ÖÓ12TÄ£Ê½
  38   1        T2L = 0xE8;   //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
  39   1        T2H = 0xFF;   //ÉèÖÃ¶¨Ê±³õÊ¼Öµ
  40   1        AUXR |= 0x10;   //¶¨Ê±Æ÷2¿ªÊ¼¼ÆÊ±
  41   1        TI=1;     // ºÜ¹Ø¼ü£¬Ê¹ÓÃprintfº¯ÊýÊ±±ØÐëÓÐ´ËÃüÁî
  42   1        
  43   1      //  TMOD|=0x20;      //ÉèT1Îª·½Ê½1£¬GATE=1£»
  44   1      //  SCON=0x50;
  45   1      //  TH1=0xFD;
  46   1      //  TL1=0xFD;
  47   1      //  TR1=1;         //¿ªÆô¶¨Ê±Æ÷1
  48   1        EA=1;        //¿ªÆô×ÜÖÐ¶Ï
  49   1      
  50   1      }
  51          
  52          /*------------------------------------------------
  53                            ¶¨Ê±Æ÷0ÖÐ¶Ï´¦Àí
  54          ------------------------------------------------*/
  55          
C51 COMPILER V9.60.0.0   MAIN                                                              05/08/2022 11:17:01 PAGE 2   

  56          void tim0_isr (void) interrupt 1 using 1
  57          {
  58   1        irtime++;  //ÓÃÓÚ¼ÆÊý2¸öÏÂ½µÑØÖ®¼äµÄÊ±¼ä
  59   1      }
  60          
  61          /*------------------------------------------------
  62                            Íâ²¿ÖÐ¶Ï0ÖÐ¶Ï´¦Àí
  63          ------------------------------------------------*/
  64          void EX0_ISR (void) interrupt 0 //Íâ²¿ÖÐ¶Ï0·þÎñº¯Êý
  65          {
  66   1          static volatile unsigned char  i =0 ;             //½ÓÊÕºìÍâÐÅºÅ´¦Àí
  67   1        static  volatile bit startflag = 1;                //ÊÇ·ñ¿ªÊ¼´¦Àí±êÖ¾Î»
  68   1        TR0 = 1;//´ò¿ª¶¨Ê±Æ÷0£¬¼ÆËã¸ßµçÆ½µÄÊ±¼ä£¨Òýµ¼Âë£©
  69   1        if(startflag)                         
  70   1        {
  71   2          if(irtime<63 && irtime>=33)//Òýµ¼Âë TC9012µÄÍ·Âë£¬9ms+4.5ms
  72   2            i=0;
  73   2          irdata[i]=irtime;//´æ´¢Ã¿¸öµçÆ½µÄ³ÖÐøÊ±¼ä£¬ÓÃÓÚÒÔºóÅÐ¶ÏÊÇ0»¹ÊÇ1
  74   2          irtime=0;
  75   2          i++;
  76   2          if(i==33)
  77   2          {
  78   3            irok=1;
  79   3            i=0;
  80   3          }
  81   2        }
  82   1        else
  83   1        {
  84   2          irtime=0;
  85   2          startflag=1;
  86   2        }
  87   1      
  88   1      }
  89          
  90          /*------------------------------------------------
  91                          ¶¨Ê±Æ÷0³õÊ¼»¯
  92          ------------------------------------------------*/
  93          void TIM0init(void)//¶¨Ê±Æ÷0³õÊ¼»¯
  94          {
  95   1      
  96   1        TMOD|=0x02;//¶¨Ê±Æ÷0¹¤×÷·½Ê½2£¬TH0ÊÇÖØ×°Öµ£¬TL0ÊÇ³õÖµ
  97   1        TH0=0x00; //ÖØÔØÖµ
  98   1        TL0=0x00; //³õÊ¼»¯Öµ
  99   1        ET0=1;    //¿ªÖÐ¶Ï
 100   1        TR0=0;    //²»¿ªÆô¶¨Ê±Æ÷0
 101   1      }
 102          /*------------------------------------------------
 103                            Íâ²¿ÖÐ¶Ï0³õÊ¼»¯
 104          ------------------------------------------------*/
 105          void EX0init(void)
 106          {
 107   1       IT0 = 1;   //Ö¸¶¨Íâ²¿ÖÐ¶Ï0ÏÂ½µÑØ´¥·¢£¬INT0 (P3.2)
 108   1       EX0 = 1;   //Ê¹ÄÜÍâ²¿ÖÐ¶Ï
 109   1       EA = 1;    //¿ª×ÜÖÐ¶Ï
 110   1      }
 111          /*------------------------------------------------
 112                            ¼üÖµ´¦Àí
 113          ------------------------------------------------*/
 114          
 115          void Ir_work(void)//ºìÍâ¼üÖµÉ¢×ª³ÌÐò
 116          {
 117   1        //·¢ËÍºìÍâÂë
C51 COMPILER V9.60.0.0   MAIN                                                              05/08/2022 11:17:01 PAGE 3   

 118   1        //ÕâÀï×ªÒåºóµÄÂëÓÉÉÏÎ»»ú½âÂëÏÔÊ¾£¬Ò²¿ÉÒÔ×Ô¼ºÉÏ´«ÏÔÊ¾£¬Ä¬ÈÏX£¬Ò²¾ÍÊÇÖ»ÒªÊÇXÔòÉÏÎ»»ú×Ô¶¯½âÂë£¬ÆäËûÖµÉÏÎ»»úÔ
             -òÏÔÊ¾ÉÏ´«µÄÖµ
 119   1        //02bxÊä³öÒÔ16½øÖÆµÄ¸ñÊ½Êä³öÕûÊýÀàÐÍµÄÊýÖµÓò¿íÎª2£¬ÓÒ¶ÔÆë£¬²»×ãµÄÓÃ×Ö·û0Ìæ´ú
 120   1        printf("RECE_IR DATA:%02bx-%02bx-%02bx-%02bx \n", IRcord[0], IRcord[1], IRcord[2], IRcord[3]); 
 121   1      
 122   1        irpro_ok=0;//Çå¿ÕÍê³É±êÖ¾
 123   1        
 124   1      }
 125          /*------------------------------------------------
 126                          ºìÍâÂëÖµ´¦Àí
 127          ------------------------------------------------*/
 128          void Ircordpro(void)//ºìÍâÂëÖµ´¦Àíº¯Êý
 129          { 
 130   1        unsigned char i, j, k;
 131   1        unsigned char cord,value;
 132   1        
 133   1        k=1;
 134   1        IRcord[0] = 0; 
 135   1        IRcord[1] = 0;
 136   1        IRcord[2] = 0;
 137   1        IRcord[3] = 0;
 138   1        for(i=0;i<4;i++)      //´¦Àí4¸ö×Ö½Ú
 139   1        {
 140   2          for(j=1;j<=8;j++) //´¦Àí1¸ö×Ö½Ú8Î»
 141   2          {
 142   3            cord=irdata[k];
 143   3            if(cord>7)//´óÓÚÄ³ÖµÎª1£¬Õâ¸öºÍ¾§ÕñÓÐ¾ø¶Ô¹ØÏµ£¬ÕâÀïÊ¹ÓÃ12M¼ÆËã£¬´ËÖµ¿ÉÒÔÓÐÒ»¶¨Îó²î
 144   3              value|=0x80;
 145   3            if(j<8)
 146   3            {
 147   4              value>>=1;
 148   4            }
 149   3            k++;
 150   3          }
 151   2          IRcord[i]=value;
 152   2          value=0;     
 153   2        } 
 154   1        irpro_ok=1;//´¦ÀíÍê±Ï±êÖ¾Î»ÖÃ1
 155   1      }
 156          /*------------------------------------------------
 157                              Ö÷º¯Êý
 158          ------------------------------------------------*/
 159          void main(void)
 160          {
 161   1        init_com();
 162   1        EX0init(); //³õÊ¼»¯Íâ²¿ÖÐ¶Ï
 163   1        TIM0init();//³õÊ¼»¯¶¨Ê±Æ÷
 164   1        while(1)//Ö÷Ñ­»·
 165   1        {
 166   2          if(irok)                        //Èç¹û½ÓÊÕºÃÁË½øÐÐºìÍâ´¦Àí
 167   2          {   
 168   3            EA = 0;
 169   3            Ircordpro();
 170   3            EA = 1;
 171   3            irok=0;
 172   3          }
 173   2          
 174   2          if(irpro_ok)                   //Èç¹û´¦ÀíºÃºó½øÐÐ¹¤×÷´¦Àí£¬Èç°´¶ÔÓ¦µÄ°´¼üºóÏÔÊ¾¶ÔÓ¦µÄÊý×ÖµÈ
 175   2          {
 176   3            EA = 0;    //¹Ø×ÜÖÐ¶Ï
 177   3            Ir_work();
 178   3            EA = 1;    //¿ªÆô×ÜÖÐ¶Ï£¬µÈ´ýÏÂÒ»´Î½ÓÊÕ
C51 COMPILER V9.60.0.0   MAIN                                                              05/08/2022 11:17:01 PAGE 4   

 179   3      
 180   3          }
 181   2        }
 182   1      }
 183            
 184            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    271    ----
   CONSTANT SIZE    =     39    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
